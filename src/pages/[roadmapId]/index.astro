---
import FAQs from '../../components/FAQs/FAQs.astro';
import FrameRenderer from '../../components/FrameRenderer/FrameRenderer.astro';
import MarkdownFile from '../../components/MarkdownFile.astro';
import RelatedRoadmaps from '../../components/RelatedRoadmaps.astro';
import RoadmapHeader from '../../components/RoadmapHeader.astro';
import { TopicDetail } from '../../components/TopicDetail/TopicDetail';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getComponentesCategoria, getRoadmapAlmacenados, getRoadmapById } from '../../database/consultas';

export const prerender = false;


interface Params extends Record<string, string | undefined> {
  roadmapId: string;
}

const { roadmapId } = Astro.params as Params;

// TODO: Mirar para a√±adir el FAQ en el archivo de datos del roadmap de la BD
//const { faqs: roadmapFAQs = [] } = await import(
  //`../../data/roadmaps/${roadmapId}/faqs.astro`
//);

//const roadmapData = roadmapFile.frontmatter as RoadmapFrontmatter;
const roadmapData = await getRoadmapById(roadmapId);

const componentesCategoria:string[] = [];

let jsonLdSchema: Record<string, unknown>[] | undefined = [];

//if (roadmapFAQs.length) {
  //jsonLdSchema.push(generateFAQSchema(roadmapFAQs));
//}

if (Astro.request.method === 'GET') {
  componentesCategoria.length = 0;
  try {
    const componentes = await getComponentesCategoria(roadmapId);
    componentes?.map((componente) => {
        componentesCategoria.push(
            componente.componenteCategoria);

    });

  } catch (error) {
    console.log(error);
  }

}

---

<BaseLayout
  permalink={`/${roadmapId}`}
  title={roadmapData?.title ?? 'Indefinido'}
  description={roadmapData?.description}
  jsonLd={jsonLdSchema}
>
  <!-- Preload the font being used in the renderer -->
  <link
    rel='preload'
    href='/fonts/balsamiq.woff2'
    as='font'
    type='font/woff2'
    crossorigin
    slot='after-header'
  />

  <RoadmapHeader
    title={roadmapData?.title ?? 'Indefinido'}
    description={roadmapData?.description ?? 'Indefinido'}
    note={roadmapData?.note}
    roadmapId={roadmapId}

  />

  <div class='bg-gray-50 pt-4 sm:pt-12'>
    {roadmapData  && (
        <div class='container relative max-w-[1000px]'>
          <TopicDetail client:idle />

          <FrameRenderer
            resourceType={'roadmap'}
            resourceId={roadmapId}
            jsonData={roadmapData.jsonRoadmap}
            dimensions={roadmapData.dimensions}
            componentesCategoria={componentesCategoria}
          
        />
        
        </div>
      )
    }

    <!--  {roadmapData && !roadmapData.jsonData && (
      
      <div class='mt-0 pb-14 sm:-mt-6'>
        <MarkdownFile>
          <roadmapFile.Content /> 
        </MarkdownFile>
      </div>
    )
   
  }-->



    <!-- <FAQs faqs={roadmapFAQs} />-->
    {roadmapData && <RelatedRoadmaps roadmap={roadmapData} />}
  </div>
</BaseLayout>
